//
// Created by alexa on 2020-06-05.
//

#include "memory_test.h"
#include "main_test.h"



void loadProgramToMemory_should_return_non_zero_on_missing_file()
{
    TEST_ASSERT_NOT_EQUAL (0, loadProgramToMemory("wrong_file_name.txt"));
}

void loadProgramToMemory_should_copy_file_to_memory(){
    uint8_t expectedresult[42*4] = {0x10, 0x00, 0x05, 0x17, 0x00, 0x05, 0x25, 0x03,
                                    0x01, 0xc0, 0x00, 0xef, 0x00, 0x05, 0x05, 0x93,
                                    0x10, 0x00, 0x05, 0x17, 0xff, 0x05, 0x25, 0x03,
                                    0x04, 0xc0, 0x00, 0xef, 0x00, 0xa0, 0x07, 0x93,
                                    0x00, 0x00, 0x00, 0x73, 0xff, 0x01, 0x01, 0x13,
                                    0x00, 0x11, 0x24, 0x23, 0x00, 0xa1, 0x20, 0x23,
                                    0xff, 0xf5, 0x02, 0x93, 0x00, 0x02, 0xd8, 0x63,
                                    0x00, 0x10, 0x05, 0x13, 0x01, 0x01, 0x01, 0x13,
                                    0x00, 0x00, 0x80, 0x67, 0xff, 0xf5, 0x05, 0x13,
                                    0xfd, 0xdf, 0xf0, 0xef, 0x00, 0x05, 0x03, 0x13,
                                    0x00, 0x01, 0x25, 0x03, 0x00, 0x81, 0x20, 0x83,
                                    0x01, 0x01, 0x01, 0x13, 0x02, 0x65, 0x05, 0x33,
                                    0x00, 0x00, 0x80, 0x67, 0x00, 0x05, 0x02, 0x93,
                                    0x00, 0x05, 0x83, 0x13, 0x10, 0x00, 0x05, 0x17,
                                    0xf9, 0x85, 0x05, 0x13, 0x00, 0x40, 0x07, 0x93,
                                    0x00, 0x00, 0x00, 0x73, 0x00, 0x02, 0x85, 0x13,
                                    0x00, 0x10, 0x07, 0x93, 0x00, 0x00, 0x00, 0x73,
                                    0x10, 0x00, 0x05, 0x17, 0xf9, 0x05, 0x05, 0x13,
                                    0x00, 0x40, 0x07, 0x93, 0x00, 0x00, 0x00, 0x73,
                                    0x00, 0x03, 0x05, 0x13, 0x00, 0x10, 0x07, 0x93,
                                    0x00, 0x00, 0x00, 0x73, 0x00, 0x00, 0x80, 0x67};

    TEST_ASSERT_EQUAL_UINT8 (0, loadProgramToMemory("riscv_test.txt"));
    TEST_ASSERT_EQUAL_UINT8_ARRAY (expectedresult, Memory, 42*4);

};

void loadProgramToMemory_should_initialize_userMemorySize_and_userMemory()
{
    TEST_ASSERT_EQUAL_UINT8 (0, loadProgramToMemory("riscv_test.txt"));
    TEST_ASSERT_EQUAL_UINT32 (MEMORY_SIZE - 42*4, userMemorySize);
    TEST_ASSERT_EQUAL_UINT32 (Memory + 42*4, userMemory);
}

void RUN_TEST_loadProgramToMemory(){
    RUN_TEST(loadProgramToMemory_should_return_non_zero_on_missing_file);
    RUN_TEST(loadProgramToMemory_should_copy_file_to_memory);
    RUN_TEST(loadProgramToMemory_should_initialize_userMemorySize_and_userMemory);
}
